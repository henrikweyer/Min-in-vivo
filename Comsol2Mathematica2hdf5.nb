(* Content-type: application/vnd.wolfram.mathematica *)

(*** Wolfram Notebook File ***)
(* http://www.wolfram.com/nb *)

(* CreatedBy='Mathematica 13.0' *)

(*CacheID: 234*)
(* Internal cache information:
NotebookFileLineBreakTest
NotebookFileLineBreakTest
NotebookDataPosition[       158,          7]
NotebookDataLength[     71399,       1602]
NotebookOptionsPosition[     67021,       1522]
NotebookOutlinePosition[     67426,       1538]
CellTagsIndexPosition[     67383,       1535]
WindowFrame->Normal*)

(* Beginning of Notebook Content *)
Notebook[{

Cell[CellGroupData[{
Cell["Comsol import functions", "Subsection",
 CellChangeTimes->{{3.8594331455969067`*^9, 3.8594331569088464`*^9}, 
   3.9004000514661045`*^9},ExpressionUUID->"54587b1c-b891-4a47-b2da-\
b60b57ad8067"],

Cell[CellGroupData[{

Cell["1D data, parameter sweep, only one component", "Subsubsection",
 CellChangeTimes->{{3.875702232419271*^9, 3.8757022404519787`*^9}, {
  3.900400057635356*^9, 3.9004000583261814`*^9}, {3.9004001426942587`*^9, 
  3.9004001431049786`*^9}},ExpressionUUID->"1a776bed-6460-425f-9db8-\
d2bd04371120"],

Cell[BoxData[
 RowBox[{"ImportExport`RegisterImport", "[", "\[IndentingNewLine]", 
  RowBox[{
  "\"\<ComsolSweep1D\>\"", ",", "\[IndentingNewLine]", 
   "ComsolSweep1D`ComsolSweep1D"}], "\[IndentingNewLine]", "]"}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.8593900222246523`*^9, 3.8593900299637737`*^9}, {
  3.8594329485574856`*^9, 3.8594329665248804`*^9}},
 CellLabel->"In[1]:=",ExpressionUUID->"6de1013b-4d8f-4949-8842-51b92aeeb3ab"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", " ", 
   RowBox[{
   "the", " ", "converter", " ", "function", " ", "takes", " ", "file", " ", 
    "name", " ", "and", " ", "options", " ", "as", " ", "arguments"}], " ", 
   "*)"}], "\[IndentingNewLine]", 
  RowBox[{"(*", " ", 
   RowBox[{
   "general", " ", "number", " ", "of", " ", "sweep", " ", "parameters"}], 
   " ", "*)"}], "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{"ComsolSweep1D`ComsolSweep1D", "[", 
    RowBox[{"filename_String", ",", " ", "options___"}], "]"}], ":=", 
   "\[IndentingNewLine]", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
      "strm", ",", " ", "head", ",", "types", ",", "parameters", ",", 
       "parameterValues", ",", "dataLin", ",", "data", ",", "cols", ",", 
       "times", ",", "grid"}], "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"strm", " ", "=", " ", 
       RowBox[{"OpenRead", "[", "filename", "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"head", " ", "=", " ", 
       RowBox[{"ReadList", "[", 
        RowBox[{"strm", ",", "\"\<String\>\"", ",", "6"}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"cols", "=", 
       RowBox[{"ToExpression", "@", 
        RowBox[{"Last", "@", 
         RowBox[{"StringSplit", "[", 
          RowBox[{"Last", "@", "head"}], "]"}]}]}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"Skip", "[", 
       RowBox[{"strm", ",", "\"\<String\>\"", ",", "1"}], "]"}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"types", "=", 
       RowBox[{"(*", " ", 
        RowBox[{
         RowBox[{
          RowBox[{
           RowBox[{"(", 
            RowBox[{
             RowBox[{
              RowBox[{"StringTrim", "[", 
               RowBox[{"StringReplace", "[", 
                RowBox[{"#", ",", 
                 RowBox[{"\"\<,\>\"", "->", "\"\<\>\""}]}], "]"}], "]"}], 
              "&"}], "/@", 
             RowBox[{
              RowBox[{"StringSplit", "[", 
               RowBox[{"#", ",", "\"\< \>\""}], "]"}], "[", 
              RowBox[{"[", 
               RowBox[{";;", 
                RowBox[{"-", "2"}]}], "]"}], "]"}]}], ")"}], "&"}], "/@", 
          RowBox[{"(", 
           RowBox[{"StringTrim", "/@", 
            RowBox[{
             RowBox[{"StringSplit", "[", 
              RowBox[{
               RowBox[{"First", "@", 
                RowBox[{"ReadList", "[", 
                 RowBox[{"strm", ",", "\"\<String\>\"", ",", "1"}], "]"}]}], 
               ",", 
               RowBox[{"{", "\"\<@\>\"", "}"}]}], "]"}], "[", 
             RowBox[{"[", 
              RowBox[{"2", ";;"}], "]"}], "]"}]}], ")"}]}], ";"}], "*)"}], 
       "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"StringSplit", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"StringSplit", "[", 
            RowBox[{"StringReplace", "[", 
             RowBox[{
              RowBox[{"First", "@", 
               RowBox[{"ReadList", "[", 
                RowBox[{"strm", ",", "\"\<String\>\"", ",", "1"}], "]"}]}], 
              ",", 
              RowBox[{"{", 
               RowBox[{
                RowBox[{"\"\< @ \>\"", "->", "\"\<@\>\""}], ",", 
                RowBox[{"\"\<, \>\"", "->", "\"\<,\>\""}]}], "}"}]}], "]"}], 
            "]"}], "[", 
           RowBox[{"[", 
            RowBox[{"3", ";;"}], "]"}], "]"}], ",", 
          RowBox[{"{", 
           RowBox[{"\"\<@\>\"", ",", "\"\<,\>\""}], "}"}]}], "]"}], "[", 
        RowBox[{"[", 
         RowBox[{"All", ",", 
          RowBox[{"2", ";;"}]}], "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"times", "=", 
       RowBox[{"ToExpression", "/@", 
        RowBox[{"StringReplace", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"Select", "[", 
            RowBox[{"types", ",", 
             RowBox[{
              RowBox[{"(", 
               RowBox[{
                RowBox[{"#", "[", 
                 RowBox[{"[", 
                  RowBox[{"2", ";;"}], "]"}], "]"}], "==", 
                RowBox[{"types", "[", 
                 RowBox[{"[", 
                  RowBox[{"1", ",", 
                   RowBox[{"2", ";;"}]}], "]"}], "]"}]}], ")"}], "&"}]}], 
            "]"}], "[", 
           RowBox[{"[", 
            RowBox[{"All", ",", "1"}], "]"}], "]"}], ",", 
          RowBox[{"\"\<t=\>\"", "->", "\"\<\>\""}]}], "]"}]}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"parameters", "=", 
       RowBox[{
        RowBox[{
         RowBox[{"(", 
          RowBox[{
           RowBox[{"StringSplit", "[", 
            RowBox[{"#", ",", "\"\<=\>\""}], "]"}], "[", 
           RowBox[{"[", "1", "]"}], "]"}], ")"}], "&"}], "/@", 
        RowBox[{"(", 
         RowBox[{"types", "[", 
          RowBox[{"[", 
           RowBox[{"1", ",", 
            RowBox[{"2", ";;"}]}], "]"}], "]"}], ")"}]}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"parameterValues", "=", 
       RowBox[{
        RowBox[{
         RowBox[{"(", 
          RowBox[{
           RowBox[{
            RowBox[{"ToExpression", "[", 
             RowBox[{
              RowBox[{"StringSplit", "[", 
               RowBox[{"#", ",", "\"\<=\>\""}], "]"}], "[", 
              RowBox[{"[", "2", "]"}], "]"}], "]"}], "&"}], "/@", "#"}], 
          ")"}], "&"}], "/@", 
        RowBox[{"(", 
         RowBox[{
          RowBox[{"Partition", "[", 
           RowBox[{"types", ",", 
            RowBox[{"Length", "@", "times"}]}], "]"}], "[", 
          RowBox[{"[", 
           RowBox[{"All", ",", "1", ",", 
            RowBox[{"2", ";;"}]}], "]"}], "]"}], ")"}]}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"dataLin", "=", " ", 
       RowBox[{"Partition", "[", 
        RowBox[{
         RowBox[{"ReadList", "[", 
          RowBox[{"strm", ",", " ", "\"\<Number\>\"", ",", 
           RowBox[{"\"\<RecordSeparators\>\"", "->", 
            RowBox[{"{", "\"\<,\>\"", "}"}]}]}], "]"}], ",", 
         RowBox[{"cols", "+", "1"}]}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"grid", "=", 
       RowBox[{"dataLin", "[", 
        RowBox[{"[", 
         RowBox[{"All", ",", "1"}], "]"}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"data", "=", " ", 
       RowBox[{"Partition", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"Transpose", "[", "dataLin", "]"}], "[", 
          RowBox[{"[", 
           RowBox[{"2", ";;"}], "]"}], "]"}], ",", 
         RowBox[{"Length", "@", "times"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"Close", "[", "strm", "]"}], ";", "\[IndentingNewLine]", 
      RowBox[{"<|", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"\"\<Header\>\"", " ", "\[Rule]", " ", "head"}], ",", 
        "\[IndentingNewLine]", 
        RowBox[{"\"\<VariedParameters\>\"", "->", "parameters"}], ",", 
        "\[IndentingNewLine]", 
        RowBox[{"\"\<ValuesVariedParameters\>\"", "->", "parameterValues"}], 
        ",", "\[IndentingNewLine]", 
        RowBox[{"\"\<Times\>\"", "->", "times"}], ",", "\[IndentingNewLine]", 
        RowBox[{"\"\<Grid\>\"", "->", "grid"}], ",", "\[IndentingNewLine]", 
        RowBox[{"\"\<Data\>\"", " ", "\[Rule]", " ", "data"}]}], 
       "\[IndentingNewLine]", "|>"}]}]}], "\[IndentingNewLine]", 
    "]"}]}]}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.866190860186779*^9, 3.8661909842106376`*^9}, {
  3.8661910300587463`*^9, 3.8661910605945187`*^9}, {3.866191416802987*^9, 
  3.866191421543891*^9}, {3.866191485148786*^9, 3.8661915195692596`*^9}, {
  3.875701728271516*^9, 3.875701736375452*^9}, {3.875701961494854*^9, 
  3.875701972476659*^9}},
 CellLabel->"In[2]:=",ExpressionUUID->"894da692-a50f-49a3-b33d-da7b9bddd24d"]
}, Closed]],

Cell[CellGroupData[{

Cell["Example", "Subsubsection",
 CellChangeTimes->{{3.8594331666052203`*^9, 
  3.8594331686210775`*^9}},ExpressionUUID->"87b3cc67-0405-4875-b012-\
1695baa7e1a4"],

Cell[BoxData[
 RowBox[{
  RowBox[{"data", "=", 
   RowBox[{"Import", "[", 
    RowBox[{"\"\<...\>\"", ",", "\"\<ComsolSweep1D\>\""}], "]"}]}], 
  ";"}]], "Input",
 CellChangeTimes->{{3.8593695791008744`*^9, 3.8593695808629484`*^9}, {
   3.8593697845995426`*^9, 3.8593698103030796`*^9}, {3.8593699021032677`*^9, 
   3.8593699024310493`*^9}, {3.85937212681474*^9, 3.859372145287217*^9}, {
   3.859390049650532*^9, 3.8593900511801786`*^9}, 3.8594329893012285`*^9, {
   3.859439692268998*^9, 3.859439694452222*^9}, {3.9004000820476565`*^9, 
   3.900400084304882*^9}},ExpressionUUID->"239888da-55df-41d4-a5dd-\
d96658c9f726"],

Cell[BoxData[
 RowBox[{"Keys", "@", "data"}]], "Input",
 CellChangeTimes->{{3.859369815096139*^9, 3.859369817934926*^9}, {
  3.859390062937107*^9, 3.859390064405668*^9}},
 CellLabel->"In[4]:=",ExpressionUUID->"eec0992c-b940-4c55-ad3d-fd579fa47d07"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(", 
   RowBox[{"\"\<Header\>\"", "/.", "data"}], ")"}], "//", 
  "TableForm"}]], "Input",
 CellChangeTimes->{{3.8593721747438517`*^9, 3.8593722161615334`*^9}},
 CellLabel->"In[5]:=",ExpressionUUID->"d374eb68-ee92-4a69-ae9b-75fad088c8d0"],

Cell[BoxData[
 RowBox[{
  RowBox[{"data", "[", "\"\<Header\>\"", "]"}], "//", "TableForm"}]], "Input",
 CellChangeTimes->{{3.8594398373103466`*^9, 3.859439846758898*^9}},
 CellLabel->"In[6]:=",ExpressionUUID->"aee6f2ad-a4b4-4c59-bad6-73c6e4584b80"],

Cell[BoxData[
 RowBox[{"InputForm", "@", 
  RowBox[{"(", 
   RowBox[{"\"\<VariedParameters\>\"", "/.", "data"}], ")"}]}]], "Input",
 CellChangeTimes->{{3.8593738364304223`*^9, 3.859373837078039*^9}, 
   3.8593739089347076`*^9, {3.85938910564464*^9, 3.859389107953514*^9}, {
   3.859389729077198*^9, 3.8593897333244524`*^9}, {3.8594330045261846`*^9, 
   3.8594330088851824`*^9}},
 CellLabel->"In[7]:=",ExpressionUUID->"59cc4b53-4a0d-4f17-a56a-90c960d5fbb5"],

Cell[BoxData[
 RowBox[{"InputForm", "[", 
  RowBox[{"\"\<ValuesVariedParameters\>\"", "/.", "data"}], "]"}]], "Input",
 CellChangeTimes->{{3.859389738342986*^9, 3.859389756987797*^9}, {
  3.8594330139330187`*^9, 3.8594330204608374`*^9}},
 CellLabel->"In[8]:=",ExpressionUUID->"74650e35-1c54-4c33-b258-9a0a73c6f706"],

Cell[BoxData[
 RowBox[{"InputForm", "[", 
  RowBox[{"\"\<Times\>\"", "/.", "data"}], "]"}]], "Input",
 CellChangeTimes->{
  3.8593739927201405`*^9, {3.8593891292841463`*^9, 3.8593891335969563`*^9}, {
   3.859389767144555*^9, 3.859389772417865*^9}},
 CellLabel->"In[9]:=",ExpressionUUID->"61b65f6e-3b25-4c0b-86ae-2def8a3ceb1e"],

Cell[BoxData[
 RowBox[{"InputForm", "[", 
  RowBox[{"\"\<Grid\>\"", "/.", "data"}], "]"}]], "Input",
 CellChangeTimes->{{3.859433044741008*^9, 3.8594330496289253`*^9}},
 CellLabel->"In[10]:=",ExpressionUUID->"61956055-9a28-43e3-ac15-154d08617d27"],

Cell[BoxData[{
 RowBox[{"Dimensions", "@", 
  RowBox[{"(", 
   RowBox[{"\"\<Data\>\"", "/.", "data"}], ")"}]}], "\[IndentingNewLine]", 
 RowBox[{"Length", "[", 
  RowBox[{"\"\<ValuesVariedParameters\>\"", "/.", "data"}], 
  "]"}], "\[IndentingNewLine]", 
 RowBox[{"Length", "[", 
  RowBox[{"\"\<Times\>\"", "/.", "data"}], "]"}], "\[IndentingNewLine]", 
 RowBox[{"Length", "[", 
  RowBox[{"\"\<Grid\>\"", "/.", "data"}], "]"}]}], "Input",
 CellChangeTimes->{{3.8593719098407383`*^9, 3.8593719128573213`*^9}, {
   3.859371962822652*^9, 3.859371965126559*^9}, {3.8593722395904655`*^9, 
   3.859372324054307*^9}, {3.8593723856226077`*^9, 3.8593723889187984`*^9}, 
   3.8593731078311415`*^9, {3.859389783365769*^9, 3.8593897859661694`*^9}, {
   3.8594330632214303`*^9, 3.8594331133576045`*^9}},
 CellLabel->"In[11]:=",ExpressionUUID->"e20bd287-cf43-46fc-b8ef-4ff0704b6050"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(", 
   RowBox[{"\"\<ValuesVariedParameters\>\"", "/.", "data"}], ")"}], "[", 
  RowBox[{"[", "113", "]"}], "]"}]], "Input",
 CellChangeTimes->{{3.859390550254404*^9, 3.8593906788892927`*^9}, {
  3.8593908543999224`*^9, 3.8593908629664435`*^9}, {3.859390914597004*^9, 
  3.8593909405086317`*^9}},
 CellLabel->"In[15]:=",ExpressionUUID->"a2784a34-0d23-4f71-9cfb-6f6f32cc240d"],

Cell[BoxData[
 RowBox[{"ListDensityPlot", "[", 
  RowBox[{
   RowBox[{
    RowBox[{"(", 
     RowBox[{"\"\<Data\>\"", "/.", "data"}], ")"}], "[", 
    RowBox[{"[", "113", "]"}], "]"}], ",", 
   RowBox[{"PlotLegends", "\[Rule]", "Automatic"}]}], "]"}]], "Input",
 CellChangeTimes->{{3.8593902939704547`*^9, 3.8593902962664156`*^9}, {
  3.8593903368462677`*^9, 3.8593903475115843`*^9}, {3.8593903775348845`*^9, 
  3.8593904873208437`*^9}, {3.85939061090889*^9, 3.8593906396245394`*^9}, {
  3.8593906828281345`*^9, 3.8593906841541595`*^9}, {3.8593908732890797`*^9, 
  3.859390873753436*^9}, {3.8593909215708046`*^9, 3.859390945246565*^9}},
 CellLabel->"In[16]:=",ExpressionUUID->"1652bc72-c0b4-4518-909d-7df27aa93843"]
}, Closed]],

Cell[CellGroupData[{

Cell["1D data, several components, parameter sweep", "Subsubsection",
 CellChangeTimes->{{3.866550642028922*^9, 3.8665506435729694`*^9}, {
  3.866550801124843*^9, 3.866550806596301*^9}, {3.8665521324090476`*^9, 
  3.8665521354976377`*^9}, {3.8757005847240973`*^9, 
  3.875700588933422*^9}},ExpressionUUID->"42180053-2f23-42d3-b37c-\
ca172b5cb029"],

Cell[BoxData[
 RowBox[{"ImportExport`RegisterImport", "[", "\[IndentingNewLine]", 
  RowBox[{
  "\"\<ComsolSweep1DMultiComp\>\"", ",", "\[IndentingNewLine]", 
   "ComsolSweep1DMultiComp`ComsolSweep1DMultiComp"}], "\[IndentingNewLine]", 
  "]"}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.8593900222246523`*^9, 3.8593900299637737`*^9}, {
  3.8594329485574856`*^9, 3.8594329665248804`*^9}, {3.875700596324758*^9, 
  3.875700608471903*^9}},
 CellLabel->"In[3]:=",ExpressionUUID->"5080316b-cae8-46a6-8db5-3274b073fc09"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", " ", 
   RowBox[{
   "the", " ", "converter", " ", "function", " ", "takes", " ", "file", " ", 
    "name", " ", "and", " ", "options", " ", "as", " ", "arguments"}], " ", 
   "*)"}], "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{"ComsolSweep1DMultiComp`ComsolSweep1DMultiComp", "[", 
    RowBox[{"filename_String", ",", " ", "options___"}], "]"}], ":=", 
   "\[IndentingNewLine]", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
      "strm", ",", " ", "head", ",", "colTypes", ",", "components", ",", 
       "parameters", ",", "parameterValues", ",", "dataLin", ",", 
       "dataParamCom", ",", "data", ",", "dataAssociation", ",", "dataComp", 
       ",", "parameterGroupNames", ",", "cols", ",", "times", ",", "grid"}], 
      "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"strm", " ", "=", " ", 
       RowBox[{"OpenRead", "[", "filename", "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"head", " ", "=", " ", 
       RowBox[{"ReadList", "[", 
        RowBox[{"strm", ",", "\"\<String\>\"", ",", "6"}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"cols", "=", 
       RowBox[{"ToExpression", "@", 
        RowBox[{"Last", "@", 
         RowBox[{"StringSplit", "[", 
          RowBox[{"Last", "@", "head"}], "]"}]}]}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"Skip", "[", 
       RowBox[{"strm", ",", "\"\<String\>\"", ",", "1"}], "]"}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"colTypes", "=", 
       RowBox[{"StringSplit", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"StringSplit", "[", 
           RowBox[{"StringReplace", "[", 
            RowBox[{
             RowBox[{"First", "@", 
              RowBox[{"ReadList", "[", 
               RowBox[{"strm", ",", "\"\<String\>\"", ",", "1"}], "]"}]}], 
             ",", 
             RowBox[{"{", 
              RowBox[{
               RowBox[{"\"\< @ \>\"", "->", "\"\<@\>\""}], ",", 
               RowBox[{"\"\<, \>\"", "->", "\"\<,\>\""}]}], "}"}]}], "]"}], 
           "]"}], "[", 
          RowBox[{"[", 
           RowBox[{"3", ";;"}], "]"}], "]"}], ",", 
         RowBox[{"{", 
          RowBox[{"\"\<@\>\"", ",", "\"\<,\>\""}], "}"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"times", "=", 
       RowBox[{"ToExpression", "/@", 
        RowBox[{"DeleteDuplicates", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"StringReplace", "[", 
            RowBox[{
             RowBox[{"#", "[", 
              RowBox[{"[", "2", "]"}], "]"}], ",", 
             RowBox[{"\"\<t=\>\"", "->", "\"\<\>\""}]}], "]"}], "&"}], "/@", 
          "colTypes"}], "]"}]}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"components", "=", 
       RowBox[{"DeleteDuplicates", "[", 
        RowBox[{"colTypes", "[", 
         RowBox[{"[", 
          RowBox[{"All", ",", "1"}], "]"}], "]"}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"parameters", "=", 
       RowBox[{
        RowBox[{
         RowBox[{"(", 
          RowBox[{
           RowBox[{"StringSplit", "[", 
            RowBox[{"#", ",", "\"\<=\>\""}], "]"}], "[", 
           RowBox[{"[", "1", "]"}], "]"}], ")"}], "&"}], "/@", 
        RowBox[{"(", 
         RowBox[{"colTypes", "[", 
          RowBox[{"[", 
           RowBox[{"1", ",", 
            RowBox[{"3", ";;"}]}], "]"}], "]"}], ")"}]}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"parameterValues", "=", 
       RowBox[{
        RowBox[{
         RowBox[{"(", 
          RowBox[{
           RowBox[{
            RowBox[{"ToExpression", "[", 
             RowBox[{
              RowBox[{"StringSplit", "[", 
               RowBox[{"#", ",", "\"\<=\>\""}], "]"}], "[", 
              RowBox[{"[", "2", "]"}], "]"}], "]"}], "&"}], "/@", "#"}], 
          ")"}], "&"}], "/@", 
        RowBox[{"(", 
         RowBox[{
          RowBox[{"Partition", "[", 
           RowBox[{"colTypes", ",", 
            RowBox[{
             RowBox[{"Length", "[", "times", "]"}], "*", 
             RowBox[{"Length", "[", "components", "]"}]}]}], "]"}], "[", 
          RowBox[{"[", 
           RowBox[{"All", ",", "1", ",", 
            RowBox[{"3", ";;"}]}], "]"}], "]"}], ")"}]}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"dataLin", "=", " ", 
       RowBox[{"Partition", "[", 
        RowBox[{
         RowBox[{"ReadList", "[", 
          RowBox[{"strm", ",", " ", "\"\<Number\>\""}], 
          RowBox[{"(*", 
           RowBox[{",", 
            RowBox[{"\"\<RecordSeparators\>\"", "->", 
             RowBox[{"{", "\"\<,\>\"", "}"}]}]}], "*)"}], "]"}], ",", 
         RowBox[{"cols", "+", "1"}]}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"grid", "=", 
       RowBox[{"dataLin", "[", 
        RowBox[{"[", 
         RowBox[{"All", ",", "1"}], "]"}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"data", "=", 
       RowBox[{"{", "}"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"Do", "[", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{
         RowBox[{"dataComp", "=", 
          RowBox[{"Transpose", "[", 
           RowBox[{
            RowBox[{"Partition", "[", 
             RowBox[{"dataParamCom", ",", 
              RowBox[{"Length", "@", "components"}]}], "]"}], ",", 
            RowBox[{"{", 
             RowBox[{"2", ",", "1", ",", "3"}], "}"}]}], "]"}]}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"AppendTo", "[", 
          RowBox[{"data", ",", 
           RowBox[{"Association", "@@", 
            RowBox[{"Thread", "[", 
             RowBox[{"components", "->", "dataComp"}], "]"}]}]}], "]"}], 
         ";"}], ",", "\[IndentingNewLine]", 
        RowBox[{"{", 
         RowBox[{"dataParamCom", ",", " ", 
          RowBox[{"Partition", "[", 
           RowBox[{
            RowBox[{
             RowBox[{"Transpose", "[", "dataLin", "]"}], "[", 
             RowBox[{"[", 
              RowBox[{"2", ";;"}], "]"}], "]"}], ",", 
            RowBox[{
             RowBox[{"Length", "[", "times", "]"}], "*", 
             RowBox[{"Length", "[", "components", "]"}]}]}], "]"}]}], "}"}]}],
        "]"}], ";", "\[IndentingNewLine]", 
      RowBox[{"parameterGroupNames", "=", 
       RowBox[{
        RowBox[{
         RowBox[{"(", 
          RowBox[{"StringJoin", "[", 
           RowBox[{"Riffle", "[", 
            RowBox[{"parameters", ",", 
             RowBox[{"ToString", "/@", "#"}]}], "]"}], "]"}], ")"}], "&"}], "/@",
         "parameterValues"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"dataAssociation", "=", 
       RowBox[{"Association", "@@", 
        RowBox[{"Thread", "[", 
         RowBox[{"parameterGroupNames", "->", "data"}], "]"}]}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"Close", "[", "strm", "]"}], ";", "\[IndentingNewLine]", 
      RowBox[{"Join", "[", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"<|", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"\"\<Header\>\"", " ", "\[Rule]", " ", "head"}], ",", 
          "\[IndentingNewLine]", 
          RowBox[{"\"\<Components\>\"", "->", "components"}], ",", 
          "\[IndentingNewLine]", 
          RowBox[{"\"\<VariedParameters\>\"", "->", "parameters"}], ",", 
          "\[IndentingNewLine]", 
          RowBox[{"\"\<ValuesVariedParameters\>\"", "->", "parameterValues"}],
           ",", "\[IndentingNewLine]", 
          RowBox[{"\"\<Times\>\"", "->", "times"}], ",", 
          "\[IndentingNewLine]", 
          RowBox[{"\"\<Grid\>\"", "->", "grid"}]}], "\[IndentingNewLine]", 
         "|>"}], ",", "\[IndentingNewLine]", "dataAssociation"}], 
       "\[IndentingNewLine]", "]"}]}]}], "\[IndentingNewLine]", 
    "]"}]}]}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.8593720567112064`*^9, 3.85937208465508*^9}, {
   3.859372159703149*^9, 3.8593721602628603`*^9}, {3.859372310487627*^9, 
   3.8593723110071115`*^9}, {3.8593723620953417`*^9, 
   3.8593723721110544`*^9}, {3.8593724594876823`*^9, 
   3.8593724629830256`*^9}, {3.8593725390233784`*^9, 
   3.8593725391669073`*^9}, {3.859372580655608*^9, 3.8593725814070225`*^9}, {
   3.8593730209437027`*^9, 3.8593730443830633`*^9}, {3.859373079983119*^9, 
   3.8593730874709406`*^9}, 3.8593731271032066`*^9, {3.859373199223093*^9, 
   3.8593733936467185`*^9}, {3.8593735391032567`*^9, 
   3.8593736236550035`*^9}, {3.8593736758234234`*^9, 
   3.8593736961826305`*^9}, {3.859373731055111*^9, 3.859373808646963*^9}, 
   3.8593738910398216`*^9, {3.859373939792857*^9, 3.8593740386949797`*^9}, {
   3.859374077071742*^9, 3.85937408154298*^9}, {3.859374116719404*^9, 
   3.8593741201030035`*^9}, {3.859374168095685*^9, 3.859374365310916*^9}, {
   3.8593744163117385`*^9, 3.859374460431135*^9}, {3.859374527623869*^9, 
   3.859374527774847*^9}, {3.8593885507079964`*^9, 3.85938856805509*^9}, {
   3.8593886855657682`*^9, 3.8593887329391413`*^9}, {3.859388769824498*^9, 
   3.859388871636427*^9}, {3.8593889512625113`*^9, 3.859388980388385*^9}, {
   3.859389027274555*^9, 3.859389076003752*^9}, {3.8593891749724245`*^9, 
   3.859389186425906*^9}, {3.8593892245255446`*^9, 3.8593892545463614`*^9}, {
   3.859389314631202*^9, 3.859389345065719*^9}, 3.85938937530754*^9, {
   3.8593894194974585`*^9, 3.8593894644661074`*^9}, {3.859389525247236*^9, 
   3.859389549604385*^9}, {3.8593895878629475`*^9, 3.8593896722433543`*^9}, {
   3.8593898037582507`*^9, 3.8593898889556274`*^9}, {3.85938991929926*^9, 
   3.8593899321631956`*^9}, 3.8593899858359337`*^9, {3.859390032012905*^9, 
   3.859390035968632*^9}, {3.8593900895549555`*^9, 3.859390129583539*^9}, {
   3.859432967846933*^9, 3.8594329695742426`*^9}, {3.859439805950592*^9, 
   3.8594398171492977`*^9}, {3.8757006136610403`*^9, 3.875700615143708*^9}, {
   3.875701077866687*^9, 3.875701086902182*^9}, {3.8757011266413927`*^9, 
   3.875701175960277*^9}, 3.875701301610652*^9, {3.875701567663239*^9, 
   3.875701569883808*^9}, {3.875701814010604*^9, 3.875701824514477*^9}, {
   3.8757020399423428`*^9, 3.8757020891907797`*^9}, {3.875702135688594*^9, 
   3.87570217271524*^9}, {3.875702444423811*^9, 3.8757024802162857`*^9}, {
   3.875702554496149*^9, 3.875702561376526*^9}, 3.875702626390601*^9, {
   3.875702673053524*^9, 3.875702677357183*^9}, {3.8757027454830837`*^9, 
   3.875702767237097*^9}, {3.8757028504837313`*^9, 3.875702850723085*^9}, {
   3.875702890960682*^9, 3.875702969295265*^9}, 3.8757030099117413`*^9, {
   3.875703144081132*^9, 3.875703153777614*^9}, {3.875703198368252*^9, 
   3.875703217766862*^9}, {3.875703374227569*^9, 3.87570347702837*^9}, {
   3.875703557323402*^9, 3.875703701883016*^9}, {3.87570375037801*^9, 
   3.875703753877997*^9}, {3.875703863096363*^9, 3.8757039337165203`*^9}, {
   3.875704004092458*^9, 3.8757040042566032`*^9}},
 CellLabel->"In[4]:=",ExpressionUUID->"9ded0858-c78b-4353-9ee3-6141c6c50884"]
}, Open  ]],

Cell[CellGroupData[{

Cell["2D data, several components, no parameter sweep", "Subsubsection",
 CellChangeTimes->{{3.866550642028922*^9, 3.8665506435729694`*^9}, {
  3.866550801124843*^9, 3.866550806596301*^9}, {3.8665521324090476`*^9, 
  3.8665521354976377`*^9}},ExpressionUUID->"dd7a5121-304f-44d6-9717-\
7e98e63ffe54"],

Cell[BoxData[
 RowBox[{"ImportExport`RegisterImport", "[", "\[IndentingNewLine]", 
  RowBox[{
  "\"\<Comsol2D\>\"", ",", "\[IndentingNewLine]", "Comsol2D`Comsol2D"}], 
  "\[IndentingNewLine]", "]"}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.8593900222246523`*^9, 3.8593900299637737`*^9}, {
  3.8594329485574856`*^9, 3.8594329665248804`*^9}, {3.8665506500128713`*^9, 
  3.8665506543966923`*^9}, {3.866552152569561*^9, 3.866552157065623*^9}},
 CellLabel->"In[5]:=",ExpressionUUID->"0788b0c9-7322-43bc-8236-7988933c7d97"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", " ", 
   RowBox[{
   "the", " ", "converter", " ", "function", " ", "takes", " ", "file", " ", 
    "name", " ", "and", " ", "options", " ", "as", " ", "arguments"}], " ", 
   "*)"}], "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{"Comsol2D`Comsol2D", "[", 
    RowBox[{"filename_String", ",", " ", "options___"}], "]"}], ":=", 
   "\[IndentingNewLine]", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
      "strm", ",", " ", "head", ",", "colTypes", ",", "components", ",", 
       "dataLin", ",", "data", ",", "cols", ",", "times", ",", "grid", ",", 
       "gridx", ",", "gridy", ",", "comp", ",", "dataComp", ",", 
       "dataAssociation"}], "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"strm", " ", "=", " ", 
       RowBox[{"OpenRead", "[", "filename", "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"head", " ", "=", " ", 
       RowBox[{"ReadList", "[", 
        RowBox[{"strm", ",", "\"\<String\>\"", ",", "6"}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"cols", "=", 
       RowBox[{"ToExpression", "@", 
        RowBox[{"Last", "@", 
         RowBox[{"StringSplit", "[", 
          RowBox[{"Last", "@", "head"}], "]"}]}]}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"Skip", "[", 
       RowBox[{"strm", ",", "\"\<String\>\"", ",", "2"}], "]"}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"colTypes", "=", 
       RowBox[{"StringSplit", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"StringSplit", "[", 
           RowBox[{"StringReplace", "[", 
            RowBox[{
             RowBox[{"First", "@", 
              RowBox[{"ReadList", "[", 
               RowBox[{"strm", ",", "\"\<String\>\"", ",", "1"}], "]"}]}], 
             ",", 
             RowBox[{"\"\< @ \>\"", "->", "\"\<@\>\""}]}], "]"}], "]"}], "[", 
          RowBox[{"[", 
           RowBox[{"4", ";;"}], "]"}], "]"}], ",", "\"\<@\>\""}], "]"}]}], 
      ";", "\[IndentingNewLine]", 
      RowBox[{"components", "=", 
       RowBox[{"DeleteDuplicates", "[", 
        RowBox[{"colTypes", "[", 
         RowBox[{"[", 
          RowBox[{"All", ",", "1"}], "]"}], "]"}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"times", "=", 
       RowBox[{"ToExpression", "/@", 
        RowBox[{"DeleteDuplicates", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"StringReplace", "[", 
            RowBox[{
             RowBox[{"#", "[", 
              RowBox[{"[", "2", "]"}], "]"}], ",", 
             RowBox[{"\"\<t=\>\"", "->", "\"\<\>\""}]}], "]"}], "&"}], "/@", 
          "colTypes"}], "]"}]}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"dataLin", "=", " ", 
       RowBox[{"Partition", "[", 
        RowBox[{
         RowBox[{"ReadList", "[", 
          RowBox[{"strm", ",", " ", "\"\<Number\>\""}], 
          RowBox[{"(*", 
           RowBox[{",", 
            RowBox[{"\"\<RecordSeparators\>\"", "->", 
             RowBox[{"{", "\"\<,\>\"", "}"}]}]}], "*)"}], "]"}], ",", 
         RowBox[{"cols", "+", "2"}]}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"grid", "=", 
       RowBox[{"dataLin", "[", 
        RowBox[{"[", 
         RowBox[{"All", ",", 
          RowBox[{"{", 
           RowBox[{"1", ",", "2"}], "}"}]}], "]"}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"gridx", "=", 
       RowBox[{"DeleteDuplicates", "[", 
        RowBox[{"grid", "[", 
         RowBox[{"[", 
          RowBox[{"All", ",", "1"}], "]"}], "]"}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"gridy", "=", 
       RowBox[{"DeleteDuplicates", "[", 
        RowBox[{"grid", "[", 
         RowBox[{"[", 
          RowBox[{"All", ",", "2"}], "]"}], "]"}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"grid", "=", 
       RowBox[{"Partition", "[", 
        RowBox[{"grid", ",", 
         RowBox[{"Length", "@", "gridx"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"data", "=", 
       RowBox[{"{", "}"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"Do", "[", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{
         RowBox[{"dataComp", "=", 
          RowBox[{"dataLin", "[", 
           RowBox[{"[", 
            RowBox[{"All", ",", 
             RowBox[{
              RowBox[{"2", "+", "comp"}], ";;", ";;", 
              RowBox[{"Length", "@", "components"}]}]}], "]"}], "]"}]}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"AppendTo", "[", 
          RowBox[{"data", ",", 
           RowBox[{"Transpose", "[", 
            RowBox[{
             RowBox[{"Partition", "[", 
              RowBox[{"dataComp", ",", 
               RowBox[{"Length", "@", "gridx"}]}], "]"}], ",", 
             RowBox[{"{", 
              RowBox[{"2", ",", "3", ",", "1"}], "}"}]}], "]"}]}], "]"}], 
         ";"}], ",", "\[IndentingNewLine]", 
        RowBox[{"{", 
         RowBox[{"comp", ",", 
          RowBox[{"Length", "@", "components"}]}], "}"}]}], "]"}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"dataAssociation", "=", 
       RowBox[{"Association", "@@", 
        RowBox[{"Thread", "[", 
         RowBox[{"components", "->", "data"}], "]"}]}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"Close", "[", "strm", "]"}], ";", "\[IndentingNewLine]", 
      RowBox[{"Join", "[", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"<|", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"\"\<Header\>\"", " ", "\[Rule]", " ", "head"}], ",", 
          "\[IndentingNewLine]", 
          RowBox[{"\"\<Components\>\"", "->", "components"}], ",", 
          "\[IndentingNewLine]", 
          RowBox[{"\"\<Times\>\"", "->", "times"}], ",", 
          "\[IndentingNewLine]", 
          RowBox[{"\"\<Grid\>\"", "->", "grid"}], ",", "\[IndentingNewLine]", 
          RowBox[{"\"\<Grid x\>\"", "->", "gridx"}], ",", 
          "\[IndentingNewLine]", 
          RowBox[{"\"\<Grid y\>\"", "->", "gridy"}]}], "\[IndentingNewLine]", 
         "|>"}], ",", "\[IndentingNewLine]", "dataAssociation"}], 
       "\[IndentingNewLine]", "]"}]}]}], "\[IndentingNewLine]", 
    "]"}]}]}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.8593720567112064`*^9, 3.85937208465508*^9}, {
   3.859372159703149*^9, 3.8593721602628603`*^9}, {3.859372310487627*^9, 
   3.8593723110071115`*^9}, {3.8593723620953417`*^9, 
   3.8593723721110544`*^9}, {3.8593724594876823`*^9, 
   3.8593724629830256`*^9}, {3.8593725390233784`*^9, 
   3.8593725391669073`*^9}, {3.859372580655608*^9, 3.8593725814070225`*^9}, {
   3.8593730209437027`*^9, 3.8593730443830633`*^9}, {3.859373079983119*^9, 
   3.8593730874709406`*^9}, 3.8593731271032066`*^9, {3.859373199223093*^9, 
   3.8593733936467185`*^9}, {3.8593735391032567`*^9, 
   3.8593736236550035`*^9}, {3.8593736758234234`*^9, 
   3.8593736961826305`*^9}, {3.859373731055111*^9, 3.859373808646963*^9}, 
   3.8593738910398216`*^9, {3.859373939792857*^9, 3.8593740386949797`*^9}, {
   3.859374077071742*^9, 3.85937408154298*^9}, {3.859374116719404*^9, 
   3.8593741201030035`*^9}, {3.859374168095685*^9, 3.859374365310916*^9}, {
   3.8593744163117385`*^9, 3.859374460431135*^9}, {3.859374527623869*^9, 
   3.859374527774847*^9}, {3.8593885507079964`*^9, 3.85938856805509*^9}, {
   3.8593886855657682`*^9, 3.8593887329391413`*^9}, {3.859388769824498*^9, 
   3.859388871636427*^9}, {3.8593889512625113`*^9, 3.859388980388385*^9}, {
   3.859389027274555*^9, 3.859389076003752*^9}, {3.8593891749724245`*^9, 
   3.859389186425906*^9}, {3.8593892245255446`*^9, 3.8593892545463614`*^9}, {
   3.859389314631202*^9, 3.859389345065719*^9}, 3.85938937530754*^9, {
   3.8593894194974585`*^9, 3.8593894644661074`*^9}, {3.859389525247236*^9, 
   3.859389549604385*^9}, {3.8593895878629475`*^9, 3.8593896722433543`*^9}, {
   3.8593898037582507`*^9, 3.8593898889556274`*^9}, {3.85938991929926*^9, 
   3.8593899321631956`*^9}, 3.8593899858359337`*^9, {3.859390032012905*^9, 
   3.859390035968632*^9}, {3.8593900895549555`*^9, 3.859390129583539*^9}, {
   3.859432967846933*^9, 3.8594329695742426`*^9}, {3.859439805950592*^9, 
   3.8594398171492977`*^9}, {3.866550656334573*^9, 3.866550658958807*^9}, {
   3.866550746342718*^9, 3.8665507467901883`*^9}, {3.8665508751179094`*^9, 
   3.866550891774644*^9}, {3.8665509819417124`*^9, 3.8665510145027757`*^9}, {
   3.8665510478058124`*^9, 3.8665510753975163`*^9}, {3.866551109189246*^9, 
   3.86655115970128*^9}, {3.8665512339168415`*^9, 3.8665513426129675`*^9}, {
   3.866551392212678*^9, 3.866551394828469*^9}, {3.86655142940439*^9, 
   3.866551476868557*^9}, {3.866551622315879*^9, 3.8665517737238474`*^9}, {
   3.866551831291613*^9, 3.8665518801875877`*^9}, {3.8665519295717564`*^9, 
   3.8665519543157396`*^9}, {3.866552001083124*^9, 3.8665520534605303`*^9}, {
   3.866552158483027*^9, 3.8665521609875712`*^9}, {3.866552211516491*^9, 
   3.866552219634531*^9}, {3.8665537833186398`*^9, 3.866553826197139*^9}, {
   3.866553900155471*^9, 3.866553900355942*^9}, {3.866554128350953*^9, 
   3.8665541320695677`*^9}, {3.8665542180340157`*^9, 3.866554218180175*^9}, {
   3.866556071177058*^9, 3.866556081913444*^9}, {3.874855915685718*^9, 
   3.874855919785345*^9}, {3.874856057451062*^9, 3.874856059412312*^9}},
 CellLabel->"In[6]:=",ExpressionUUID->"dc5f6059-e5bc-4fb8-b047-2711b1f2e306"]
}, Closed]],

Cell[CellGroupData[{

Cell["2D data, several components, parameter sweep", "Subsubsection",
 CellChangeTimes->{{3.866550642028922*^9, 3.8665506435729694`*^9}, {
  3.866550801124843*^9, 3.866550806596301*^9}, {3.8665521324090476`*^9, 
  3.8665521354976377`*^9}, {3.8748572373391743`*^9, 
  3.8748572400795727`*^9}},ExpressionUUID->"c2265669-b55c-44c1-961d-\
c89481fe2a81"],

Cell[BoxData[
 RowBox[{"ImportExport`RegisterImport", "[", "\[IndentingNewLine]", 
  RowBox[{
  "\"\<Comsol2DSweep\>\"", ",", "\[IndentingNewLine]", 
   "Comsol2DSweep`Comsol2DSweep"}], "\[IndentingNewLine]", "]"}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.8593900222246523`*^9, 3.8593900299637737`*^9}, {
  3.8594329485574856`*^9, 3.8594329665248804`*^9}, {3.8665506500128713`*^9, 
  3.8665506543966923`*^9}, {3.866552152569561*^9, 3.866552157065623*^9}, {
  3.8748558608567*^9, 3.8748558616535387`*^9}, {3.874856183941791*^9, 
  3.874856186769943*^9}},
 CellLabel->"In[7]:=",ExpressionUUID->"e6dc7ece-6c58-42e8-8a83-dda539e367cc"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", " ", 
   RowBox[{
   "the", " ", "converter", " ", "function", " ", "takes", " ", "file", " ", 
    "name", " ", "and", " ", "options", " ", "as", " ", "arguments"}], " ", 
   "*)"}], "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{"Comsol2DSweep`Comsol2DSweep", "[", 
    RowBox[{"filename_String", ",", " ", "options___"}], "]"}], ":=", 
   "\[IndentingNewLine]", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
      "strm", ",", " ", "head", ",", "colTypes", ",", "components", ",", 
       "sweepParams", ",", "sweepValues", ",", "dataLin", ",", "data", ",", 
       "cols", ",", "times", ",", "grid", ",", "gridx", ",", "gridy", ",", 
       "comp", ",", "dataComp", ",", "dataAssociation"}], "}"}], ",", 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"strm", " ", "=", " ", 
       RowBox[{"OpenRead", "[", "filename", "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"head", " ", "=", " ", 
       RowBox[{"ReadList", "[", 
        RowBox[{"strm", ",", "\"\<String\>\"", ",", "6"}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"cols", "=", 
       RowBox[{"ToExpression", "@", 
        RowBox[{"Last", "@", 
         RowBox[{"StringSplit", "[", 
          RowBox[{"Last", "@", "head"}], "]"}]}]}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"Skip", "[", 
       RowBox[{"strm", ",", "\"\<String\>\"", ",", "2"}], "]"}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"colTypes", "=", 
       RowBox[{"StringSplit", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"StringSplit", "[", 
           RowBox[{"StringReplace", "[", 
            RowBox[{
             RowBox[{"First", "@", 
              RowBox[{"ReadList", "[", 
               RowBox[{"strm", ",", "\"\<String\>\"", ",", "1"}], "]"}]}], 
             ",", 
             RowBox[{"{", 
              RowBox[{
               RowBox[{"\"\< @ \>\"", "->", "\"\<@\>\""}], ",", 
               RowBox[{"\"\<, \>\"", "->", "\"\<,\>\""}]}], "}"}]}], "]"}], 
           "]"}], "[", 
          RowBox[{"[", 
           RowBox[{"4", ";;"}], "]"}], "]"}], ",", 
         RowBox[{"{", 
          RowBox[{"\"\<@\>\"", ",", "\"\<,\>\""}], "}"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"components", "=", 
       RowBox[{"DeleteDuplicates", "[", 
        RowBox[{"colTypes", "[", 
         RowBox[{"[", 
          RowBox[{"All", ",", "1"}], "]"}], "]"}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"times", "=", 
       RowBox[{"ToExpression", "/@", 
        RowBox[{"DeleteDuplicates", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"StringReplace", "[", 
            RowBox[{
             RowBox[{"#", "[", 
              RowBox[{"[", "2", "]"}], "]"}], ",", 
             RowBox[{"\"\<t=\>\"", "->", "\"\<\>\""}]}], "]"}], "&"}], "/@", 
          "colTypes"}], "]"}]}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"sweepParams", "=", 
       RowBox[{
        RowBox[{
         RowBox[{"(", 
          RowBox[{
           RowBox[{"StringSplit", "[", 
            RowBox[{"#", ",", "\"\<=\>\""}], "]"}], "[", 
           RowBox[{"[", "1", "]"}], "]"}], ")"}], "&"}], "/@", 
        RowBox[{"colTypes", "[", 
         RowBox[{"[", 
          RowBox[{"1", ",", 
           RowBox[{"3", ";;"}]}], "]"}], "]"}]}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"sweepValues", "=", 
       RowBox[{
        RowBox[{
         RowBox[{"(", 
          RowBox[{"ToExpression", "/@", 
           RowBox[{"DeleteDuplicates", "[", 
            RowBox[{
             RowBox[{
              RowBox[{
               RowBox[{"StringSplit", "[", 
                RowBox[{"#", ",", "\"\<=\>\""}], "]"}], "[", 
               RowBox[{"[", 
                RowBox[{"-", "1"}], "]"}], "]"}], "&"}], "/@", "#"}], "]"}]}],
           ")"}], "&"}], "/@", 
        RowBox[{"Transpose", "[", 
         RowBox[{"colTypes", "[", 
          RowBox[{"[", 
           RowBox[{"All", ",", 
            RowBox[{"3", ";;"}]}], "]"}], "]"}], "]"}]}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"dataLin", "=", " ", 
       RowBox[{"Partition", "[", 
        RowBox[{
         RowBox[{"ReadList", "[", 
          RowBox[{"strm", ",", " ", "\"\<Number\>\""}], 
          RowBox[{"(*", 
           RowBox[{",", 
            RowBox[{"\"\<RecordSeparators\>\"", "->", 
             RowBox[{"{", "\"\<,\>\"", "}"}]}]}], "*)"}], "]"}], ",", 
         RowBox[{"cols", "+", "2"}]}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"grid", "=", 
       RowBox[{"dataLin", "[", 
        RowBox[{"[", 
         RowBox[{"All", ",", 
          RowBox[{"{", 
           RowBox[{"1", ",", "2"}], "}"}]}], "]"}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"gridx", "=", 
       RowBox[{"DeleteDuplicates", "[", 
        RowBox[{"grid", "[", 
         RowBox[{"[", 
          RowBox[{"All", ",", "1"}], "]"}], "]"}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"gridy", "=", 
       RowBox[{"DeleteDuplicates", "[", 
        RowBox[{"grid", "[", 
         RowBox[{"[", 
          RowBox[{"All", ",", "2"}], "]"}], "]"}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"grid", "=", 
       RowBox[{"Partition", "[", 
        RowBox[{"grid", ",", 
         RowBox[{"Length", "@", "gridx"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"data", "=", 
       RowBox[{"{", "}"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"Do", "[", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{
         RowBox[{"dataComp", "=", 
          RowBox[{"dataLin", "[", 
           RowBox[{"[", 
            RowBox[{"All", ",", 
             RowBox[{
              RowBox[{"2", "+", "comp"}], ";;", ";;", 
              RowBox[{"Length", "@", "components"}]}]}], "]"}], "]"}]}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"AppendTo", "[", 
          RowBox[{"data", ",", 
           RowBox[{"Transpose", "[", 
            RowBox[{
             RowBox[{"Partition", "[", 
              RowBox[{"dataComp", ",", 
               RowBox[{"Length", "@", "gridx"}]}], "]"}], ",", 
             RowBox[{"{", 
              RowBox[{"2", ",", "3", ",", "1"}], "}"}]}], "]"}]}], "]"}], 
         ";"}], ",", "\[IndentingNewLine]", 
        RowBox[{"{", 
         RowBox[{"comp", ",", 
          RowBox[{"Length", "@", "components"}]}], "}"}]}], "]"}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"dataAssociation", "=", 
       RowBox[{"Association", "@@", 
        RowBox[{"Thread", "[", 
         RowBox[{"components", "->", "data"}], "]"}]}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"Close", "[", "strm", "]"}], ";", "\[IndentingNewLine]", 
      RowBox[{"Join", "[", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"<|", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"\"\<Header\>\"", " ", "\[Rule]", " ", "head"}], ",", 
          "\[IndentingNewLine]", 
          RowBox[{"\"\<Components\>\"", "->", "components"}], ",", 
          "\[IndentingNewLine]", 
          RowBox[{"\"\<SweepParams\>\"", "->", "sweepParams"}], ",", 
          "\[IndentingNewLine]", 
          RowBox[{"\"\<SweepValues\>\"", "->", "sweepValues"}], ",", 
          "\[IndentingNewLine]", 
          RowBox[{"\"\<Times\>\"", "->", "times"}], ",", 
          "\[IndentingNewLine]", 
          RowBox[{"\"\<Grid\>\"", "->", "grid"}], ",", "\[IndentingNewLine]", 
          RowBox[{"\"\<Grid x\>\"", "->", "gridx"}], ",", 
          "\[IndentingNewLine]", 
          RowBox[{"\"\<Grid y\>\"", "->", "gridy"}]}], "\[IndentingNewLine]", 
         "|>"}], ",", "\[IndentingNewLine]", "dataAssociation"}], 
       "\[IndentingNewLine]", "]"}]}]}], "\[IndentingNewLine]", 
    "]"}]}]}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.8593720567112064`*^9, 3.85937208465508*^9}, {
   3.859372159703149*^9, 3.8593721602628603`*^9}, {3.859372310487627*^9, 
   3.8593723110071115`*^9}, {3.8593723620953417`*^9, 
   3.8593723721110544`*^9}, {3.8593724594876823`*^9, 
   3.8593724629830256`*^9}, {3.8593725390233784`*^9, 
   3.8593725391669073`*^9}, {3.859372580655608*^9, 3.8593725814070225`*^9}, {
   3.8593730209437027`*^9, 3.8593730443830633`*^9}, {3.859373079983119*^9, 
   3.8593730874709406`*^9}, 3.8593731271032066`*^9, {3.859373199223093*^9, 
   3.8593733936467185`*^9}, {3.8593735391032567`*^9, 
   3.8593736236550035`*^9}, {3.8593736758234234`*^9, 
   3.8593736961826305`*^9}, {3.859373731055111*^9, 3.859373808646963*^9}, 
   3.8593738910398216`*^9, {3.859373939792857*^9, 3.8593740386949797`*^9}, {
   3.859374077071742*^9, 3.85937408154298*^9}, {3.859374116719404*^9, 
   3.8593741201030035`*^9}, {3.859374168095685*^9, 3.859374365310916*^9}, {
   3.8593744163117385`*^9, 3.859374460431135*^9}, {3.859374527623869*^9, 
   3.859374527774847*^9}, {3.8593885507079964`*^9, 3.85938856805509*^9}, {
   3.8593886855657682`*^9, 3.8593887329391413`*^9}, {3.859388769824498*^9, 
   3.859388871636427*^9}, {3.8593889512625113`*^9, 3.859388980388385*^9}, {
   3.859389027274555*^9, 3.859389076003752*^9}, {3.8593891749724245`*^9, 
   3.859389186425906*^9}, {3.8593892245255446`*^9, 3.8593892545463614`*^9}, {
   3.859389314631202*^9, 3.859389345065719*^9}, 3.85938937530754*^9, {
   3.8593894194974585`*^9, 3.8593894644661074`*^9}, {3.859389525247236*^9, 
   3.859389549604385*^9}, {3.8593895878629475`*^9, 3.8593896722433543`*^9}, {
   3.8593898037582507`*^9, 3.8593898889556274`*^9}, {3.85938991929926*^9, 
   3.8593899321631956`*^9}, 3.8593899858359337`*^9, {3.859390032012905*^9, 
   3.859390035968632*^9}, {3.8593900895549555`*^9, 3.859390129583539*^9}, {
   3.859432967846933*^9, 3.8594329695742426`*^9}, {3.859439805950592*^9, 
   3.8594398171492977`*^9}, {3.866550656334573*^9, 3.866550658958807*^9}, {
   3.866550746342718*^9, 3.8665507467901883`*^9}, {3.8665508751179094`*^9, 
   3.866550891774644*^9}, {3.8665509819417124`*^9, 3.8665510145027757`*^9}, {
   3.8665510478058124`*^9, 3.8665510753975163`*^9}, {3.866551109189246*^9, 
   3.86655115970128*^9}, {3.8665512339168415`*^9, 3.8665513426129675`*^9}, {
   3.866551392212678*^9, 3.866551394828469*^9}, {3.86655142940439*^9, 
   3.866551476868557*^9}, {3.866551622315879*^9, 3.8665517737238474`*^9}, {
   3.866551831291613*^9, 3.8665518801875877`*^9}, {3.8665519295717564`*^9, 
   3.8665519543157396`*^9}, {3.866552001083124*^9, 3.8665520534605303`*^9}, {
   3.866552158483027*^9, 3.8665521609875712`*^9}, {3.866552211516491*^9, 
   3.866552219634531*^9}, {3.8665537833186398`*^9, 3.866553826197139*^9}, {
   3.866553900155471*^9, 3.866553900355942*^9}, {3.866554128350953*^9, 
   3.8665541320695677`*^9}, {3.8665542180340157`*^9, 3.866554218180175*^9}, {
   3.866556071177058*^9, 3.866556081913444*^9}, {3.874855878957142*^9, 
   3.874855882557222*^9}, {3.874856021229618*^9, 3.87485603144956*^9}, {
   3.874856065277752*^9, 3.8748560656043262`*^9}, {3.8748561733201513`*^9, 
   3.8748561767788553`*^9}, {3.874856230252982*^9, 3.87485623503547*^9}, {
   3.8748562871117373`*^9, 3.874856409730793*^9}, {3.874856440566277*^9, 
   3.87485648505301*^9}, {3.874856519382209*^9, 3.874856546637833*^9}, {
   3.874857169833353*^9, 3.874857201463801*^9}, {3.874857336521534*^9, 
   3.874857336671163*^9}},
 CellLabel->"In[8]:=",ExpressionUUID->"836b945c-c790-4f21-8a17-22a2205ed32d"]
}, Closed]]
}, Open  ]],

Cell[CellGroupData[{

Cell["hdf5 export functions", "Subsection",
 CellChangeTimes->{{3.8594331981248927`*^9, 3.8594332128129826`*^9}, 
   3.900400052980357*^9},ExpressionUUID->"645e8586-fe17-43bc-b582-\
defaae64232f"],

Cell[CellGroupData[{

Cell["1D data, several components, parameter sweep", "Subsubsection",
 CellChangeTimes->{{3.8665521186730404`*^9, 3.8665521299854555`*^9}, {
  3.8781875030528812`*^9, 
  3.8781875054993057`*^9}},ExpressionUUID->"76568260-38c5-4432-b7a8-\
a97b1ccbe372"],

Cell["data: Data from \[OpenCurlyDoubleQuote]ComsolSweep1DMultiComp\
\[CloseCurlyDoubleQuote]", "Text",
 CellChangeTimes->{{3.8781889297239933`*^9, 
  3.878188944125824*^9}},ExpressionUUID->"10dccac2-129a-4cf1-a848-\
e76b8d36b856"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"ClearAll", "[", "hdf5ExportSweep1D", "]"}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"hdf5ExportSweep1D", "[", 
    RowBox[{"filename_", ",", "data_", ",", "metadata_"}], "]"}], ":=", 
   RowBox[{"Block", "[", 
    RowBox[{
     RowBox[{
     "{", "\[IndentingNewLine]", "datastructure", "\[IndentingNewLine]", 
      "}"}], ",", "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"datastructure", "=", 
       RowBox[{"Flatten", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"Function", "[", 
           RowBox[{"singleParamData", ",", 
            RowBox[{
             RowBox[{
              RowBox[{"(", 
               RowBox[{
                RowBox[{"(", 
                 RowBox[{"singleParamData", "<>", "\"\</\>\"", "<>", "#"}], 
                 ")"}], "->", 
                RowBox[{
                 RowBox[{"data", "[", "singleParamData", "]"}], "[", "#", 
                 "]"}]}], ")"}], "&"}], "/@", 
             RowBox[{"Keys", "[", 
              RowBox[{"data", "[", "singleParamData", "]"}], "]"}]}]}], "]"}],
           "/@", 
          RowBox[{"Keys", "[", 
           RowBox[{"data", "[", 
            RowBox[{"[", 
             RowBox[{"7", ";;"}], "]"}], "]"}], "]"}]}], ",", "1"}], "]"}]}], 
      ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"Export", "[", 
       RowBox[{"filename", ",", 
        RowBox[{"Join", "[", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"{", "\[IndentingNewLine]", 
           RowBox[{"\"\</\>\"", "->", 
            RowBox[{"{", "\[IndentingNewLine]", 
             RowBox[{"\"\<Attributes\>\"", "->", 
              RowBox[{"Join", "[", "\[IndentingNewLine]", 
               RowBox[{
                RowBox[{"{", 
                 RowBox[{
                  RowBox[{"\"\<Model\>\"", "->", 
                   RowBox[{"Last", "@", 
                    RowBox[{"StringSplit", "[", 
                    RowBox[{
                    RowBox[{"(", 
                    RowBox[{"\"\<Header\>\"", "/.", "data"}], ")"}], "[", 
                    RowBox[{"[", "1", "]"}], "]"}], "]"}]}]}], ",", 
                  "\[IndentingNewLine]", 
                  RowBox[{"\"\<ComsolVersion\>\"", "->", 
                   RowBox[{"StringRiffle", "[", 
                    RowBox[{
                    RowBox[{"StringSplit", "[", 
                    RowBox[{
                    RowBox[{"(", 
                    RowBox[{"\"\<Header\>\"", "/.", "data"}], ")"}], "[", 
                    RowBox[{"[", "2", "]"}], "]"}], "]"}], "[", 
                    RowBox[{"[", 
                    RowBox[{
                    RowBox[{"-", "2"}], ";;"}], "]"}], "]"}], "]"}]}], ",", 
                  "\[IndentingNewLine]", 
                  RowBox[{"\"\<Date\>\"", "->", 
                   RowBox[{"StringRiffle", "[", 
                    RowBox[{
                    RowBox[{"StringSplit", "[", 
                    RowBox[{
                    RowBox[{"(", 
                    RowBox[{"\"\<Header\>\"", "/.", "data"}], ")"}], "[", 
                    RowBox[{"[", "3", "]"}], "]"}], "]"}], "[", 
                    RowBox[{"[", 
                    RowBox[{
                    RowBox[{"-", "4"}], ";;"}], "]"}], "]"}], "]"}]}], ",", 
                  "\[IndentingNewLine]", 
                  RowBox[{"\"\<ExportedDomainDimension\>\"", "->", 
                   RowBox[{"N", "@", 
                    RowBox[{"ToExpression", "@", 
                    RowBox[{"Last", "@", 
                    RowBox[{"StringSplit", "[", 
                    RowBox[{
                    RowBox[{"(", 
                    RowBox[{"\"\<Header\>\"", "/.", "data"}], ")"}], "[", 
                    RowBox[{"[", "4", "]"}], "]"}], "]"}]}]}]}]}], ",", 
                  "\[IndentingNewLine]", 
                  RowBox[{"\"\<Setup\>\"", "->", 
                   RowBox[{"StringReplace", "[", 
                    RowBox[{
                    RowBox[{"Last", "@", 
                    RowBox[{"StringSplit", "[", 
                    RowBox[{
                    RowBox[{"(", 
                    RowBox[{"\"\<Header\>\"", "/.", "data"}], ")"}], "[", 
                    RowBox[{"[", "1", "]"}], "]"}], "]"}]}], ",", 
                    RowBox[{"\"\<.mph\>\"", "->", "\"\<-setup.mph\>\""}]}], 
                    "]"}]}], ",", "\[IndentingNewLine]", 
                  RowBox[{"\"\<VariedParameters\>\"", "->", 
                   RowBox[{"(", 
                    RowBox[{"\"\<VariedParameters\>\"", "/.", "data"}], 
                    ")"}]}], ",", "\[IndentingNewLine]", 
                  RowBox[{"\"\<RecordedComponents\>\"", "->", 
                   RowBox[{"(", 
                    RowBox[{"\"\<Components\>\"", "/.", "data"}], ")"}]}], 
                  ",", "\[IndentingNewLine]", 
                  RowBox[{"\"\<DatasetDimensions\>\"", "->", 
                   RowBox[{"{", 
                    RowBox[{
                    RowBox[{"Length", "[", 
                    RowBox[{"data", "[", "\"\<Times\>\"", "]"}], "]"}], ",", 
                    RowBox[{"Length", "[", 
                    RowBox[{"data", "[", "\"\<Grid\>\"", "]"}], "]"}]}], 
                    "}"}]}]}], "}"}], ",", "\[IndentingNewLine]", 
                "metadata"}], "]"}]}], "\[IndentingNewLine]", "}"}]}], 
           "\[IndentingNewLine]", "}"}], ",", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"(", 
            RowBox[{"data", "/.", 
             RowBox[{"Association", "->", "List"}]}], ")"}], "[", 
           RowBox[{"[", 
            RowBox[{"4", ";;", "6"}], "]"}], "]"}], ",", 
          "\[IndentingNewLine]", "datastructure"}], "\[IndentingNewLine]", 
         "]"}], ",", "\"\<Datasets\>\""}], "]"}]}]}], "\[IndentingNewLine]", 
    "]"}]}], ";"}]}], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.8594332150702057`*^9, 3.8594332607008734`*^9}, {
   3.859433335333256*^9, 3.8594333404769425`*^9}, {3.8594362768294706`*^9, 
   3.859436312093302*^9}, {3.8594363848935833`*^9, 3.8594364137175007`*^9}, {
   3.8594367428777175`*^9, 3.859436764149747*^9}, {3.8594368221492023`*^9, 
   3.859436960909064*^9}, {3.859437277332981*^9, 3.8594372892533035`*^9}, {
   3.859437353132961*^9, 3.859437380317474*^9}, {3.8594375551179104`*^9, 
   3.859437621405272*^9}, {3.859437815981862*^9, 3.8594379152380886`*^9}, {
   3.859438947342223*^9, 3.8594389500369844`*^9}, {3.8594393140374002`*^9, 
   3.8594393178610215`*^9}, {3.8594408097234755`*^9, 
   3.8594408183242645`*^9}, {3.859441122599902*^9, 3.8594411803718967`*^9}, {
   3.859441395149763*^9, 3.8594414403721933`*^9}, {3.8594415260840883`*^9, 
   3.8594416639132495`*^9}, {3.866552228066447*^9, 3.8665522297868*^9}, {
   3.866552277378604*^9, 3.866552312098053*^9}, 3.866554549586282*^9, {
   3.8665546119251204`*^9, 3.866554625961719*^9}, {3.878187528111657*^9, 
   3.878187592182123*^9}, {3.878187788628085*^9, 3.878187795102542*^9}, {
   3.8781884462216063`*^9, 3.8781884627042627`*^9}, {3.878188527722803*^9, 
   3.878188698293487*^9}, {3.878188749655918*^9, 3.878188750270879*^9}, {
   3.878188803163311*^9, 3.878188905842607*^9}, {3.878214890718893*^9, 
   3.8782149005314207`*^9}, 3.878214952906399*^9, {3.878214993547023*^9, 
   3.878215045515785*^9}, {3.8782172231568666`*^9, 3.8782172445317507`*^9}, {
   3.8782173148751416`*^9, 3.878217317656636*^9}, {3.878217348140901*^9, 
   3.8782173690158176`*^9}, {3.8782174121095324`*^9, 3.878217413125166*^9}, {
   3.8782175112818613`*^9, 3.8782175552188907`*^9}, 3.878217597718906*^9, {
   3.8782176289381075`*^9, 3.8782176341876636`*^9}, {3.878217670969139*^9, 
   3.8782177495313787`*^9}},
 CellLabel->"In[9]:=",ExpressionUUID->"8385ef12-707c-4a91-b894-98a57e2750d1"]
}, Open  ]],

Cell[CellGroupData[{

Cell["2D data, several components, no parameter sweep", "Subsubsection",
 CellChangeTimes->{{3.8665521186730404`*^9, 
  3.8665521299854555`*^9}},ExpressionUUID->"dfe96a7c-ffe9-414c-9537-\
0523cb2621f3"],

Cell["\<\
data: data of the form imported by the Comsol import function\
\>", "Text",
 CellChangeTimes->{{3.8594332277732306`*^9, 
  3.859433243340867*^9}},ExpressionUUID->"c91a121d-2f3e-4f91-a178-\
d0c571b1695d"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"ClearAll", "[", "hdf5Export2D", "]"}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"hdf5Export2D", "[", 
    RowBox[{"filename_", ",", "data_", ",", "metadata_"}], "]"}], ":=", 
   "\[IndentingNewLine]", 
   RowBox[{"Export", "[", 
    RowBox[{"filename", ",", 
     RowBox[{"Join", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"\"\</\>\"", "->", 
         RowBox[{"{", 
          RowBox[{"\"\<Attributes\>\"", "->", 
           RowBox[{"Join", "[", 
            RowBox[{
             RowBox[{"{", 
              RowBox[{
               RowBox[{"\"\<Model\>\"", "->", 
                RowBox[{"Last", "@", 
                 RowBox[{"StringSplit", "[", 
                  RowBox[{
                   RowBox[{"(", 
                    RowBox[{"\"\<Header\>\"", "/.", "data"}], ")"}], "[", 
                   RowBox[{"[", "1", "]"}], "]"}], "]"}]}]}], ",", 
               "\[IndentingNewLine]", 
               RowBox[{"\"\<ComsolVersion\>\"", "->", 
                RowBox[{"StringRiffle", "[", 
                 RowBox[{
                  RowBox[{"StringSplit", "[", 
                   RowBox[{
                    RowBox[{"(", 
                    RowBox[{"\"\<Header\>\"", "/.", "data"}], ")"}], "[", 
                    RowBox[{"[", "2", "]"}], "]"}], "]"}], "[", 
                  RowBox[{"[", 
                   RowBox[{
                    RowBox[{"-", "2"}], ";;"}], "]"}], "]"}], "]"}]}], ",", 
               "\[IndentingNewLine]", 
               RowBox[{"\"\<Date\>\"", "->", 
                RowBox[{"StringRiffle", "[", 
                 RowBox[{
                  RowBox[{"StringSplit", "[", 
                   RowBox[{
                    RowBox[{"(", 
                    RowBox[{"\"\<Header\>\"", "/.", "data"}], ")"}], "[", 
                    RowBox[{"[", "3", "]"}], "]"}], "]"}], "[", 
                  RowBox[{"[", 
                   RowBox[{
                    RowBox[{"-", "4"}], ";;"}], "]"}], "]"}], "]"}]}], ",", 
               "\[IndentingNewLine]", 
               RowBox[{"\"\<ExportedDomainDimension\>\"", "->", 
                RowBox[{"N", "@", 
                 RowBox[{"ToExpression", "@", 
                  RowBox[{"Last", "@", 
                   RowBox[{"StringSplit", "[", 
                    RowBox[{
                    RowBox[{"(", 
                    RowBox[{"\"\<Header\>\"", "/.", "data"}], ")"}], "[", 
                    RowBox[{"[", "4", "]"}], "]"}], "]"}]}]}]}]}], ",", 
               "\[IndentingNewLine]", 
               RowBox[{"\"\<Components\>\"", "->", 
                RowBox[{"(", 
                 RowBox[{"\"\<Components\>\"", "/.", "data"}], ")"}]}], ",", 
               "\[IndentingNewLine]", 
               RowBox[{"\"\<DatasetDimensions\>\"", "->", 
                RowBox[{"Dimensions", "[", 
                 RowBox[{"data", "[", 
                  RowBox[{
                   RowBox[{"data", "[", "\"\<Components\>\"", "]"}], "[", 
                   RowBox[{"[", "1", "]"}], "]"}], "]"}], "]"}]}]}], "}"}], 
             ",", "metadata"}], "]"}]}], "}"}]}], "}"}], ",", 
       "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"(", 
         RowBox[{"data", "/.", 
          RowBox[{"Association", "->", "List"}]}], ")"}], "[", 
        RowBox[{"[", 
         RowBox[{"3", ";;"}], "]"}], "]"}]}], "]"}], ",", 
     "\"\<Datasets\>\""}], "]"}]}], ";"}]}], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.8594332150702057`*^9, 3.8594332607008734`*^9}, {
   3.859433335333256*^9, 3.8594333404769425`*^9}, {3.8594362768294706`*^9, 
   3.859436312093302*^9}, {3.8594363848935833`*^9, 3.8594364137175007`*^9}, {
   3.8594367428777175`*^9, 3.859436764149747*^9}, {3.8594368221492023`*^9, 
   3.859436960909064*^9}, {3.859437277332981*^9, 3.8594372892533035`*^9}, {
   3.859437353132961*^9, 3.859437380317474*^9}, {3.8594375551179104`*^9, 
   3.859437621405272*^9}, {3.859437815981862*^9, 3.8594379152380886`*^9}, {
   3.859438947342223*^9, 3.8594389500369844`*^9}, {3.8594393140374002`*^9, 
   3.8594393178610215`*^9}, {3.8594408097234755`*^9, 
   3.8594408183242645`*^9}, {3.859441122599902*^9, 3.8594411803718967`*^9}, {
   3.859441395149763*^9, 3.8594414403721933`*^9}, {3.8594415260840883`*^9, 
   3.8594416639132495`*^9}, {3.866552142570753*^9, 3.866552146850777*^9}, 
   3.8665522017227936`*^9, {3.866554469385632*^9, 3.8665544728510437`*^9}, {
   3.866554561888928*^9, 3.866554604591889*^9}},
 CellLabel->"In[11]:=",ExpressionUUID->"74365e32-e6c7-4746-800f-cc3e415fe928"]
}, Closed]]
}, Open  ]],

Cell[CellGroupData[{

Cell["hdf5 import function", "Subsection",
 CellChangeTimes->{{3.859438878860712*^9, 
  3.8594388839562244`*^9}},ExpressionUUID->"25bea74a-c95d-4832-90da-\
729a04860dd9"],

Cell["\<\
filename has to have the same form as in the built-in Import[]-function\
\>", "Text",
 CellChangeTimes->{{3.8594388946046553`*^9, 3.8594389059324875`*^9}, {
   3.859439386044053*^9, 3.8594394031800756`*^9}, {3.8781889912414627`*^9, 
   3.8781889982472677`*^9}, 
   3.8781898039257727`*^9},ExpressionUUID->"41a3f0b3-323a-4f52-8f36-\
3bc2f491d618"],

Cell["\<\
Import from hdf5 file in similar format as created by \
\[OpenCurlyDoubleQuote]ComsolSweep1DMultiComp\[CloseCurlyDoubleQuote] from \
Comsol .txt export \
\>", "Text",
 CellChangeTimes->{
  3.8781890069371758`*^9, {3.878189061000746*^9, 3.8781890760273857`*^9}, {
   3.900400198397809*^9, 
   3.900400228717136*^9}},ExpressionUUID->"5f775289-652e-4d63-875d-\
f7e092a6b1be"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"ClearAll", "[", "hdf5ImportSweep1D", "]"}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"hdf5ImportSweep1D", "[", "filename_", "]"}], ":=", 
   RowBox[{"Block", "[", 
    RowBox[{
     RowBox[{"{", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"data", "=", 
        RowBox[{"Import", "[", 
         RowBox[{"filename", ",", "\"\<Data\>\""}], "]"}]}], ",", 
       "\[IndentingNewLine]", 
       RowBox[{"attr", "=", 
        RowBox[{"Import", "[", 
         RowBox[{"filename", ",", 
          RowBox[{"{", 
           RowBox[{"\"\<Attributes\>\"", ",", "\"\</\>\""}], "}"}]}], "]"}]}],
        ",", "\[IndentingNewLine]", "dataKeys", ",", "\[IndentingNewLine]", 
       "datastructure"}], "\[IndentingNewLine]", "}"}], ",", 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"dataKeys", "=", 
       RowBox[{
        RowBox[{
         RowBox[{
          RowBox[{"StringSplit", "[", 
           RowBox[{"#", ",", "\"\</\>\""}], "]"}], "[", 
          RowBox[{"[", "1", "]"}], "]"}], "&"}], "/@", 
        RowBox[{"Keys", "[", 
         RowBox[{"data", "[", "\"\</Data\>\"", "]"}], "]"}]}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"datastructure", "=", 
       RowBox[{
        RowBox[{"Function", "[", 
         RowBox[{"paramKey", ",", 
          RowBox[{"paramKey", "->", 
           RowBox[{"Thread", "[", 
            RowBox[{
             RowBox[{"attr", "[", 
              RowBox[{"[", "\"\<RecordedComponents\>\"", "]"}], "]"}], "->", 
             RowBox[{"(", 
              RowBox[{
               RowBox[{"data", "[", "\"\</Data\>\"", "]"}], "[", 
               RowBox[{
                RowBox[{
                 RowBox[{"StringJoin", "[", 
                  RowBox[{"paramKey", ",", "\"\</\>\"", ",", "#"}], "]"}], 
                 "&"}], "/@", 
                RowBox[{"attr", "[", 
                 RowBox[{"[", "\"\<RecordedComponents\>\"", "]"}], "]"}]}], 
               "]"}], ")"}]}], "]"}]}]}], "]"}], "/@", "dataKeys"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"<|", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"\"\<Header\>\"", "->", 
         RowBox[{"KeyDrop", "[", 
          RowBox[{"attr", ",", 
           RowBox[{"{", 
            RowBox[{
            "\"\<VariedParameters\>\"", ",", "\"\<RecordedComponents\>\""}], 
            "}"}]}], "]"}]}], ",", "\[IndentingNewLine]", 
        RowBox[{"\"\<VariedParameters\>\"", "->", 
         RowBox[{"attr", "[", 
          RowBox[{"[", "\"\<VariedParameters\>\"", "]"}], "]"}]}], ",", 
        "\[IndentingNewLine]", 
        RowBox[{"\"\<Components\>\"", "->", 
         RowBox[{"attr", "[", 
          RowBox[{"[", "\"\<RecordedComponents\>\"", "]"}], "]"}]}], ",", 
        "\[IndentingNewLine]", 
        RowBox[{"\"\<ValuesVariedParameters\>\"", "->", 
         RowBox[{"data", "[", "\"\</ValuesVariedParameters\>\"", "]"}]}], ",",
         "\[IndentingNewLine]", 
        RowBox[{"\"\<Times\>\"", "->", 
         RowBox[{"data", "[", "\"\</Times\>\"", "]"}]}], ",", 
        "\[IndentingNewLine]", 
        RowBox[{"\"\<Grid\>\"", "->", 
         RowBox[{"data", "[", "\"\</Grid\>\"", "]"}]}], ",", 
        "\[IndentingNewLine]", 
        RowBox[{"\"\<Data\>\"", "->", "datastructure"}]}], 
       "\[IndentingNewLine]", "|>"}]}]}], "\[IndentingNewLine]", "]"}]}], 
  ";"}]}], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.859438919119239*^9, 3.8594390173245764`*^9}, {
   3.859439208628318*^9, 3.8594393075885468`*^9}, {3.859439358212917*^9, 
   3.8594393736365285`*^9}, 3.85943944199686*^9, {3.8594394786701527`*^9, 
   3.859439532444702*^9}, {3.8594398666865253`*^9, 3.8594398756602907`*^9}, {
   3.859439908269092*^9, 3.859439921788591*^9}, {3.8781890973777313`*^9, 
   3.878189101151454*^9}, {3.878189164646698*^9, 3.878189192608245*^9}, {
   3.878189253424909*^9, 3.878189260389762*^9}, {3.878189296339685*^9, 
   3.878189615115282*^9}, {3.878189656210988*^9, 3.878189705209963*^9}},
 CellLabel->"In[13]:=",ExpressionUUID->"8cdcefb4-b7c6-415e-b4a5-71a92f671dc4"]
}, Open  ]]
},
WindowSize->{718.5, 831.},
WindowMargins->{{-5.25, Automatic}, {Automatic, 0}},
FrontEndVersion->"13.1 for Microsoft Windows (64-bit) (August 22, 2022)",
StyleDefinitions->"Default.nb",
ExpressionUUID->"ee5d6a86-7a05-4e0e-adc0-fa6d09e169c7"
]
(* End of Notebook Content *)

(* Internal cache information *)
(*CellTagsOutline
CellTagsIndex->{}
*)
(*CellTagsIndex
CellTagsIndex->{}
*)
(*NotebookFileOutline
Notebook[{
Cell[CellGroupData[{
Cell[580, 22, 200, 3, 54, "Subsection",ExpressionUUID->"54587b1c-b891-4a47-b2da-b60b57ad8067"],
Cell[CellGroupData[{
Cell[805, 29, 298, 4, 45, "Subsubsection",ExpressionUUID->"1a776bed-6460-425f-9db8-d2bd04371120"],
Cell[1106, 35, 453, 8, 102, "Input",ExpressionUUID->"6de1013b-4d8f-4949-8842-51b92aeeb3ab",
 InitializationCell->True],
Cell[1562, 45, 7676, 193, 577, "Input",ExpressionUUID->"894da692-a50f-49a3-b33d-da7b9bddd24d",
 InitializationCell->True]
}, Closed]],
Cell[CellGroupData[{
Cell[9275, 243, 162, 3, 37, "Subsubsection",ExpressionUUID->"87b3cc67-0405-4875-b012-1695baa7e1a4"],
Cell[9440, 248, 620, 12, 28, "Input",ExpressionUUID->"239888da-55df-41d4-a5dd-d96658c9f726"],
Cell[10063, 262, 248, 4, 28, "Input",ExpressionUUID->"eec0992c-b940-4c55-ad3d-fd579fa47d07"],
Cell[10314, 268, 273, 6, 28, "Input",ExpressionUUID->"d374eb68-ee92-4a69-ae9b-75fad088c8d0"],
Cell[10590, 276, 248, 4, 28, "Input",ExpressionUUID->"aee6f2ad-a4b4-4c59-bad6-73c6e4584b80"],
Cell[10841, 282, 456, 8, 28, "Input",ExpressionUUID->"59cc4b53-4a0d-4f17-a56a-90c960d5fbb5"],
Cell[11300, 292, 315, 5, 28, "Input",ExpressionUUID->"74650e35-1c54-4c33-b258-9a0a73c6f706"],
Cell[11618, 299, 326, 6, 28, "Input",ExpressionUUID->"61b65f6e-3b25-4c0b-86ae-2def8a3ceb1e"],
Cell[11947, 307, 247, 4, 28, "Input",ExpressionUUID->"61956055-9a28-43e3-ac15-154d08617d27"],
Cell[12197, 313, 869, 16, 86, "Input",ExpressionUUID->"e20bd287-cf43-46fc-b8ef-4ff0704b6050"],
Cell[13069, 331, 410, 8, 28, "Input",ExpressionUUID->"a2784a34-0d23-4f71-9cfb-6f6f32cc240d"],
Cell[13482, 341, 715, 13, 28, "Input",ExpressionUUID->"1652bc72-c0b4-4518-909d-7df27aa93843"]
}, Closed]],
Cell[CellGroupData[{
Cell[14234, 359, 347, 5, 37, "Subsubsection",ExpressionUUID->"42180053-2f23-42d3-b37c-ca172b5cb029"],
Cell[14584, 366, 532, 10, 102, "Input",ExpressionUUID->"5080316b-cae8-46a6-8db5-3274b073fc09",
 InitializationCell->True],
Cell[15119, 378, 10816, 235, 863, "Input",ExpressionUUID->"9ded0858-c78b-4353-9ee3-6141c6c50884",
 InitializationCell->True]
}, Open  ]],
Cell[CellGroupData[{
Cell[25972, 618, 299, 4, 45, "Subsubsection",ExpressionUUID->"dd7a5121-304f-44d6-9717-7e98e63ffe54"],
Cell[26274, 624, 536, 9, 102, "Input",ExpressionUUID->"0788b0c9-7322-43bc-8236-7988933c7d97",
 InitializationCell->True],
Cell[26813, 635, 9281, 195, 692, "Input",ExpressionUUID->"dc5f6059-e5bc-4fb8-b047-2711b1f2e306",
 InitializationCell->True]
}, Closed]],
Cell[CellGroupData[{
Cell[36131, 835, 349, 5, 37, "Subsubsection",ExpressionUUID->"c2265669-b55c-44c1-961d-c89481fe2a81"],
Cell[36483, 842, 650, 11, 102, "Input",ExpressionUUID->"e6dc7ece-6c58-42e8-8a83-dda539e367cc",
 InitializationCell->True],
Cell[37136, 855, 11305, 245, 806, "Input",ExpressionUUID->"836b945c-c790-4f21-8a17-22a2205ed32d",
 InitializationCell->True]
}, Closed]]
}, Open  ]],
Cell[CellGroupData[{
Cell[48490, 1106, 196, 3, 54, "Subsection",ExpressionUUID->"645e8586-fe17-43bc-b582-defaae64232f"],
Cell[CellGroupData[{
Cell[48711, 1113, 252, 4, 45, "Subsubsection",ExpressionUUID->"76568260-38c5-4432-b7a8-a97b1ccbe372"],
Cell[48966, 1119, 231, 4, 35, "Text",ExpressionUUID->"10dccac2-129a-4cf1-a848-e76b8d36b856"],
Cell[49200, 1125, 7761, 156, 577, "Input",ExpressionUUID->"8385ef12-707c-4a91-b894-98a57e2750d1",
 InitializationCell->True]
}, Open  ]],
Cell[CellGroupData[{
Cell[56998, 1286, 202, 3, 45, "Subsubsection",ExpressionUUID->"dfe96a7c-ffe9-414c-9537-0523cb2621f3"],
Cell[57203, 1291, 213, 5, 35, "Text",ExpressionUUID->"c91a121d-2f3e-4f91-a178-d0c571b1695d"],
Cell[57419, 1298, 4546, 97, 197, "Input",ExpressionUUID->"74365e32-e6c7-4746-800f-cc3e415fe928",
 InitializationCell->True]
}, Closed]]
}, Open  ]],
Cell[CellGroupData[{
Cell[62014, 1401, 170, 3, 54, "Subsection",ExpressionUUID->"25bea74a-c95d-4832-90da-729a04860dd9"],
Cell[62187, 1406, 356, 7, 35, "Text",ExpressionUUID->"41a3f0b3-323a-4f52-8f36-3bc2f491d618"],
Cell[62546, 1415, 382, 9, 35, "Text",ExpressionUUID->"5f775289-652e-4d63-875d-f7e092a6b1be"],
Cell[62931, 1426, 4074, 93, 444, "Input",ExpressionUUID->"8cdcefb4-b7c6-415e-b4a5-71a92f671dc4",
 InitializationCell->True]
}, Open  ]]
}
]
*)

